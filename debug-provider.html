<!DOCTYPE html>
<html>
<head>
    <title>API æä¾›å•†è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>ğŸ” Sora API æä¾›å•†è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h2>1. æŸ¥çœ‹ localStorage é…ç½®</h2>
        <button onclick="checkConfig()">æ£€æŸ¥é…ç½®</button>
        <pre id="config-output"></pre>
    </div>
    
    <div class="section">
        <h2>2. æµ‹è¯•é…ç½®å‡½æ•°</h2>
        <button onclick="testGetProvider()">æµ‹è¯• getSoraProvider()</button>
        <button onclick="testGetApiKey()">æµ‹è¯• getProviderApiKey()</button>
        <pre id="test-output"></pre>
    </div>
    
    <div class="section">
        <h2>3. è®¾ç½®äº‘é›¾ APIï¼ˆæµ‹è¯•ï¼‰</h2>
        <button onclick="setYunwu()">è®¾ç½®ä¸ºäº‘é›¾ API</button>
        <button onclick="setSutu()">è®¾ç½®ä¸ºé€Ÿæ¨ API</button>
        <pre id="set-output"></pre>
    </div>
    
    <div class="section">
        <h2>4. æ¸…é™¤é…ç½®</h2>
        <button onclick="clearConfig()" style="background: #f44336;">æ¸…é™¤æ‰€æœ‰é…ç½®</button>
    </div>

    <script type="module">
        const SORA_CONFIG_KEY = 'sora_storage_config';
        
        function getSoraStorageConfig() {
            const stored = localStorage.getItem(SORA_CONFIG_KEY);
            if (!stored) return {};
            try {
                return JSON.parse(stored);
            } catch (e) {
                console.error('Failed to parse config:', e);
                return {};
            }
        }
        
        function saveSoraStorageConfig(config) {
            localStorage.setItem(SORA_CONFIG_KEY, JSON.stringify(config));
        }
        
        function getSoraProvider() {
            const config = getSoraStorageConfig();
            return config.provider || 'sutu';
        }
        
        function saveSoraProvider(provider) {
            const config = getSoraStorageConfig();
            config.provider = provider;
            saveSoraStorageConfig(config);
            console.log('[Debug] API æä¾›å•†å·²è®¾ç½®ä¸º:', provider);
        }
        
        function getProviderApiKey() {
            const provider = getSoraProvider();
            const config = getSoraStorageConfig();
            
            if (provider === 'sutu') {
                return config.apiKey || config.sutuApiKey || null;
            } else if (provider === 'yunwu') {
                return config.yunwuApiKey || null;
            }
            return null;
        }
        
        window.checkConfig = function() {
            const config = getSoraStorageConfig();
            const output = document.getElementById('config-output');
            output.innerHTML = '<span class="success">âœ… å½“å‰é…ç½®:</span>\n' + JSON.stringify(config, null, 2);
        };
        
        window.testGetProvider = function() {
            const provider = getSoraProvider();
            const output = document.getElementById('test-output');
            output.innerHTML = '<span class="success">âœ… getSoraProvider() è¿”å›:</span>\n' + provider + '\n\n' + 
                '(å½“å‰é€‰æ‹©çš„ API æä¾›å•†)';
        };
        
        window.testGetApiKey = function() {
            const provider = getSoraProvider();
            const apiKey = getProviderApiKey();
            const output = document.getElementById('test-output');
            output.innerHTML = '<span class="success">âœ… getProviderApiKey() è¿”å›:</span>\n' + 
                'æä¾›å•†: ' + provider + '\n' +
                'API Key: ' + (apiKey ? apiKey.substring(0, 20) + '...' : 'æœªè®¾ç½®') + '\n' +
                (apiKey ? 'âœ… API Key å·²é…ç½®' : 'âŒ API Key æœªé…ç½®');
        };
        
        window.setYunwu = function() {
            saveSoraProvider('yunwu');
            const output = document.getElementById('set-output');
            output.innerHTML = '<span class="success">âœ… å·²è®¾ç½®ä¸ºäº‘é›¾ API</span>\n' +
                'è¯·ç‚¹å‡»"æ£€æŸ¥é…ç½®"ç¡®è®¤';
        };
        
        window.setSutu = function() {
            saveSoraProvider('sutu');
            const output = document.getElementById('set-output');
            output.innerHTML = '<span class="success">âœ… å·²è®¾ç½®ä¸ºé€Ÿæ¨ API</span>\n' +
                'è¯·ç‚¹å‡»"æ£€æŸ¥é…ç½®"ç¡®è®¤';
        };
        
        window.clearConfig = function() {
            localStorage.removeItem(SORA_CONFIG_KEY);
            alert('é…ç½®å·²æ¸…é™¤');
            location.reload();
        };
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.checkConfig();
    </script>
</body>
</html>
